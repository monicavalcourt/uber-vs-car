<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Uber vs. Car</title>

    <style type="text/CSS">
    * { padding: 0; margin: 100; padding-left: 100; }
    #map {
    	width: 30em;
    	height: 20em;
      }

    div.bottomBackground{
    background: #202024 url(https://d1a3f4spazzrp4.cloudfront.net/web-fresh/pattern-grid-dark@1x.gif) repeat left top;
    background-size: 18px 18px;
    opacity: 0.9
    }

    body {
    background: #fff url(https://d1a3f4spazzrp4.cloudfront.net/web-fresh/pattern-grid@1x.jpg) repeat left top;
    color: #000;
    padding-left: 25px;
    padding-bottom: -100px;
    }

    </style>

    <script type = "text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script type = "text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
</head>

<body>

    <!-- div for grey background at bottom of page -->
    <div class = "bottomBackground" style = "position:absolute; height:45%; width:105%; top:65%; margin-left: -5%; z-index: -10"> </div>

    <h1 style="text-align:center; font-size:3.8em; font-family: Impact; letter-spacing: .1em; word-spacing: .5em; margin-right: 2em; margin-top: -.5%">UBER VS. CAR</h1>
    <div id="map" style="height:17em;margin-left:5%;width:30%;float:left; margin-top:-2.5%"></div>

    <!-- Form for user to enter in their avg ride data, calculates uber and car costs on submit -->
    <form onsubmit="calculateTotalPrice(); return false" style="position:absolute; width:35%; right:3.5%;line-height:2.5em; top:8.5%; font-size: 1.2em">
    	Rides per Week:
    	<input id="ridesPerWeek" style = "font-size:1em;"type="number" name="ridesPerWeek"><br>
    	Distance per Ride (in <span id="distanceUnit">miles</span>):
    	<input id="distanceOfRides" style = "font-size:1em" type="number" name="distanceOfRides"><br>
    	Duration of Ride (in minutes):
    	<input id="durationOfRides" style = "font-size:1em" type="number" name="durationOfRides"><br>
        Parking Cost per Week:
        <input id="parkingCost" style = "font-size:1em" type="number" name="parkingCost"><br>
    	<input type="submit" style="color:red; font-size:1em; width:30%; height:110%">
    </form>

    <!-- Form for users to enter their current city data, displays list of matched cities below -->
    <form onsubmit="return false;" style = "position:absolute; height:16%; width:20%; margin-top: -2.5%; border:.05em solid; left:39%">
            <input style = "width:98%; font-size:1.2em; margin-left: 0.5%" type="text" id="citySearch" placeholder="Enter your city..." oninput="searchCity()" >
            <ul id="cityListDisplay" style="font-size:1.2em; height:76%; width:95%; list-style-type: none; padding-left: .5em; overflow:auto; margin-top: 0%"></ul>
    </form>

    <!-- Short explanation for site -->
    <div style = "position:absolute; height:23%; width:20%; margin-top:9%; border:.1em dashed; left:39%; text-align:center; font-size:1.1em; font-family:Avantgarde, sans-serif">
        <p style = "margin-top:.5em">Is having a personal driver for a year less expensive than driving yourself? Using the Uber&reg; API and surveyed information of the cost-per-year of different cars, fuel prices, and maintenance costs, this website evaluates their relative price tags.</p>
    </div>

    <!-- Art for the uber side of final results -->
    <img src = "http://thecelebritycafe.com/sites/default/files/images/uber.jpg" alt="Uber Logo"height="23%" width="13.8%" style="left:20%; top:58%; position:absolute">
    <img height="16%" width="30%" alt="banner" style="position:absolute; top:83%; left:12%" src ="right-banner.png">
    <!-- Outputs uber's final price results -->
    <h3 id="uberFinal" style="position:absolute; top:81%; left:12.2%; width:30%; height:14%; font-size: 3em; text-align:center; color:grey"></h3>

    <!-- Art for the car side -->
    <img id = "carImage" src = "http://file.kelleybluebookimages.com/kbb/vehicleimage/evoxseo/cp/l/9736/2015-ford-taurus-front_9736_032_640x480_yz.png" alt="Car" height="55%" width="40%" style="right:8%; top:42%; position:absolute" >
    <h4 id = "carName" style="position:absolute; top:49%; right:14%; width:30%; height:14%; font-size: 1.5em; text-align:center"> 2015 Ford Taurus </h4>
    <img height="16%" width="30%" alt="banner" style="position:absolute; right:14%; top:83%" src="http://www.cutecliparts.com/wp-content/uploads/2015/11/Cool-Ribbon-Clip-Art1-550x191.png">
    <!-- Outputs car's final price results -->
    <h3 style="position:absolute; top:81%; right:14%; width:30%; height:14%; font-size: 3em; text-align:center; color:grey" id ="carPrice"></h3>

    <!-- Buttons to switch car index to different classes of cars -->
    <div style = "position:absolute; float:right; width:15%; height:60%; top:55%; line-height: 3em; column-width: 5em; right:-5%">
        <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative;" type="button" onclick="upCar(0)"> Car </button><br>
        <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="upCar(5)"> SUV </button><br>
        <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="upCar(9)"> Luxury </button><br>
        <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="upCar(12)"> Truck </button><br>
        <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative;" type="button" onclick="upCar(15)"> Electric </button><br>
    </div>

    <!-- Buttons to increment or decrement car index -->
    <input type="image" id="upCar" src="http://www.pngdot.com/wp-content/uploads/2015/11/Png_Up_Arrow_01.png" name="saveForm" class="btTxt submit" style="position:absolute; top:48.5%; right:25%; width:8%; height:4%" onclick="upCar(1)">
    <input type="image" id="downCar" src="http://www.clker.com/cliparts/C/C/t/u/L/0/arrow-down-gray-hi.png" name="saveForm" class="btTxt submit" style="position:absolute; top:81%; right:25%; width:8%; height:4%" onclick="upCar(-1)">

    <script type="text/javascript">

        var userCity = null;
        var userCityIndex = null;

        var baseFare = null;
        var costPerMinute = null;
        var costPerDistance = null;
        var minimumFare = null;
        var cancellationFee = null;
        var safeRidesFee = null;
        var distanceUnit = null;
        var currencyCode = null;

        var carIndex = 3;
        var carImageUrl = "";
        var carName = "2015 Ford Taurus";
        var carPrice = "47418";
        var submitPressed = false;

        //uses jquery to retrieve the price data for all cities and the price data for all cars
        $.getJSON("allCityPrices.json", function(data){
            allCityPrices = data;
        }).error(function(jqXhr, textStatus, error) {
            console.log("allCityPrices ERROR: " + textStatus + ", " + error);
        });
        $.getJSON("carPrices.json", function(data){
            carPrices = data;
        }).error(function(jqXhr, textStatus, error) {
            console.log("carPrices ERROR: " + textStatus + ", " + error);
        });

        //matches user-input to a list of cities, shows list of results below
        function searchCity(){
            var userInput = document.getElementById("citySearch").value;
            var cityListDisplay = document.getElementById("cityListDisplay");
            var matchedCities = [];

            $.each(allCityPrices, function(index,cityData){
                cityLower = cityData.cityState[0].toLowerCase();
                if (cityLower.indexOf(userInput.toLowerCase()) >= 0){
                    matchedCities.push(index);
                }
            });

            //clear previous list of matched cities each time
            $(cityListDisplay).empty();

            //create list node object for each city that matched the user input
            for(var i=0; i<matchedCities.length; i++){
                if (matchedCities[i]){
                    myCityIndex = matchedCities[i];
                    myCity = allCityPrices[myCityIndex];

                    var LI = document.createElement("LI");
                    cityStateString = myCity.cityState[0];
                    if (myCity.cityState[1]){
                        cityStateString += ", " + myCity.cityState[1];
                    }
                    var textnode = document.createTextNode(cityStateString);
                    LI.appendChild(textnode);

                    LI.setAttribute("id", myCityIndex);
                    LI.addEventListener("mouseover", highlightMe, false);
                    LI.addEventListener("mouseout", unhighlightMe, false);
                    LI.addEventListener("click", setCityData, true);

                    cityListDisplay.appendChild(LI);
                }
            }

            if (matchedCities.length === 0){
                var noCityLI = document.createElement("LI");
                var noCityText = document.createTextNode("No City Found");
                noCityLI.appendChild(noCityText);
                cityListDisplay.appendChild(noCityLI);
            }
        }

        //highlight in blue the city that the user is hovering over, add a GO! button to click
        function highlightMe(){
            this.setAttribute("style","background-color:Cyan");
            var myButton = document.createElement("button");
            myButton.innerHTML = "GO!";
            myButton.id = "myButton";
            myButton.setAttribute("style","margin-left:2em; pointer-events:none");
            this.appendChild(myButton);
        }

        //clear the blue highlight and go button when user stops hovering over city
        function unhighlightMe(){
            this.setAttribute("style","");
            this.removeChild(myButton);
        }

        //once user chooses city, grab all price data for that city, display their choice in bold
        function setCityData(){
            userCityIndex = this.id;
            userCity = allCityPrices[userCityIndex];

            $(cityListDisplay).empty();
            var LI = document.createElement("LI");
            LI.style.fontWeight = "bold";
            cityStateString = userCity.cityState[0];
            if (userCity.cityState[1]){
                cityStateString += ", " + userCity.cityState[1];
            }
            var textnode = document.createTextNode(cityStateString);
            LI.appendChild(textnode);
            cityListDisplay.appendChild(LI);

            goToMap();
            baseFare = userCity.priceData.baseFare;
            costPerMinute = userCity.priceData.costPerMinute;
            costPerDistance = userCity.priceData.costPerDistance;
            minimumFare = userCity.priceData.minimumFare;
            cancellationFee = userCity.priceData.cancellationFee;
            safeRidesFee = userCity.priceData.safeRidesFee;
            distanceUnit = userCity.priceData.distanceUnit;
            currencyCode = userCity.priceData.currencyCode;

            //change the distance Unit displayed for different cities (metric friendly)
            if (distanceUnit == "km"){
                document.getElementById("distanceUnit").childNodes[0].nodeValue = "kilometers";
            }
            else if (distanceUnit == "mile"){
                document.getElementById("distanceUnit").childNodes[0].nodeValue = "miles";
            }
        }

        function calculateTotalPrice(){
            //uses city data gathered from Uber API to calculate avg cost of ride per week, then year
            if (!userCity){
                alert("You must choose a city!");
                return;
            }
            var ridesPerWeek = document.getElementById("ridesPerWeek").value;
            var distanceOfRides = document.getElementById("distanceOfRides").value;
            var durationOfRides = document.getElementById("durationOfRides").value;
            var parkingPerWeek = document.getElementById("parkingCost").value;

            //test if user entered invalid input into htmlnumber box
            if (!(ridesPerWeek && durationOfRides && durationOfRides && parkingPerWeek)){
                alert("Please enter numbers");
                return;
            }
            submitPressed = true;

            var ridesPerYear = ridesPerWeek * 52.14;
            var parkingPerYear = parkingPerWeek * 52.14;
            var pricePerRide = ((distanceOfRides*costPerDistance)+(durationOfRides*costPerMinute)+baseFare+safeRidesFee);
            if (pricePerRide < minimumFare) {
                pricePerRide = minimumFare;
            }
            var pricePerYear = ridesPerYear*pricePerRide;
            pricePerYear = Math.round(pricePerYear);

            //use 4-year car price data from car websites and divide by 4 to get price per year of car
            var finalCarPrice = (carPrice/4) + parkingPerYear;
            finalCarPrice = Math.round(finalCarPrice);
            
            document.getElementById("carPrice").innerHTML = '$' + finalCarPrice;
            document.getElementById("uberFinal").innerHTML = '$' + pricePerYear;
        }

        //use google API to display a map centered around the user's chosen city
        function initMap(mapLat,mapLong,mapZoom) {
            var mapCanvas = document.getElementById('map');
            var mapOptions = {
                center: new google.maps.LatLng(mapLat, mapLong),
                zoom: mapZoom,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(mapCanvas, mapOptions);
        }
        google.maps.event.addDomListener(window, 'load', initMap(40,-100,3));

        //change latitude and longitude of displayed city when user chooses new city
        function goToMap(){
            initMap();
            var cityLat = userCity.coordinates[0];
            var cityLong = userCity.coordinates[1];
            initMap(cityLat,cityLong,13);
        }

        //change car choice by 1, or skip to index of different classes of cars (SUV, truck, etc..)
        function upCar(num){
            if (Math.abs(num) == 1){
                carIndex += num;
            }
            else{
                carIndex = num;
            }
            if (carIndex > (carPrices.length-1)){
                carIndex = carPrices.length-1;
            }
            if (carIndex < (0)){
                carIndex = 0;
            }
            carImageUrl = carPrices[carIndex].imageUrl;
            carName = carPrices[carIndex].carName;
            carPrice = carPrices[carIndex].price;
            document.getElementById("carImage").src = carImageUrl;
            document.getElementById("carName").innerHTML = carName;
            //if user's initial manual submit has occured, changing the car will automatically re-calculate total price
            if (submitPressed){
                calculateTotalPrice();
            }
        }
    </script>

</body>
</html>
