<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8" />
    <title>Uber GITHUB</title>
    <style>
    * { padding: 0; margin: 100; padding-left: 100; }
    #map {
    	width: 30em;
    	height: 20em;
      }
    </style>
    </style>

	<script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js"></script>

</head>

<body>
    <h1 style="text-align:center;font-size: 3.8em"> UBER VS. CAR</h1>
    <div id="map" style="height:10em;margin-left:25%;width:20%;float:left; margin-top:-2%"></div>
    <script>
    //<div id="map" style="height:16em;margin-left:10%;width:32%;float:left"></div>

	//Monica, is it even necessary to set this surgeDict up here? Probably not
    //var mySurgeDict = null;

    var userCity = null;
    var userCityIndex = null;

    var baseFare = null;
    var costPerMinute = null;
    var costPerDistance = null;
    var minimumFare = null;
    var cancellationFee = null;
    var safeRidesFee = null;
    var distanceUnit = null;
    var currencyCode = null;

    $.getJSON("allCityPrices.json", function(data){
        allCityPrices = data;
    }).error(function(jqXhr, textStatus, error) {
        alert("allCityPrices ERROR: " + textStatus + ", " + error);
    });

    $.getJSON("carPrices.json", function(data){
        carPrices = data;
    }).error(function(jqXhr, textStatus, error) {
        alert("carPrices ERROR: " + textStatus + ", " + error);
    });


    function searchCity(){
    	var userInput = document.getElementById("citySearch").value;
    	var cityListDisplay = document.getElementById("cityListDisplay");
    	var matchedCities = [];

    	$.each(allCityPrices, function(index,cityData){
            cityLower = cityData.cityState[0].toLowerCase();
            if (cityLower.indexOf(userInput.toLowerCase()) >= 0){
            	matchedCities.push(index);
            }
        });
        
    	$(cityListDisplay).empty();

    	for(var i=0; i<matchedCities.length; i++){
            if (matchedCities[i]){
                myCityIndex = matchedCities[i];
                myCity = allCityPrices[myCityIndex];

                var LI = document.createElement("LI");
                cityStateString = myCity.cityState[0] + ", " + myCity.cityState[1];
                var textnode = document.createTextNode(cityStateString);
                LI.appendChild(textnode);

                LI.setAttribute("id", myCityIndex);
                LI.addEventListener("mouseover", highlightMe, false);
                LI.addEventListener("mouseout", unhighlightMe, false);
                LI.addEventListener("click", setCityData, true);

                cityListDisplay.appendChild(LI);
    		}
    	}

    	if (matchedCities.length === 0){
    		var noCityLI = document.createElement("LI");
    		var noCityText = document.createTextNode("No City Found");
    		noCityLI.appendChild(noCityText);
    		cityListDisplay.appendChild(noCityLI);
    	}
    }

    function highlightMe(){
    	this.setAttribute("style","background-color:Cyan");
    	var myButton = document.createElement("button");
    	myButton.innerHTML = "GO!";
    	myButton.id = "myButton";
    	myButton.setAttribute("style","margin-left:2em; pointer-events:none");
    	this.appendChild(myButton);
    }

    function unhighlightMe(){
    	this.setAttribute("style","");
    	this.removeChild(myButton);
    }

    function setCityData(){
        userCityIndex = this.id;
        userCity = allCityPrices[userCityIndex];
        //cityStateString = userCity.cityState[0] + ", " + userCity.cityState[1];
        //alert(userCity.cityState);
    	goToMap();
    	baseFare = userCity.priceData.baseFare;
    	costPerMinute = userCity.priceData.costPerMinute;
    	costPerDistance = userCity.priceData.costPerDistance;
    	minimumFare = userCity.priceData.minimumFare;
    	cancellationFee = userCity.priceData.cancellationFee;
    	safeRidesFee = userCity.priceData.safeRidesFee;
    	distanceUnit = userCity.priceData.distanceUnit;
    	currencyCode = userCity.priceData.currencyCode;
        alert("baseFare: " + (baseFare + safeRidesFee) + " costPerMinute: " + costPerMinute + " costPerDistance: " + costPerDistance);
        //alert(costPerMinute);
        //alert(minimumFare);
    	if (distanceUnit == "km"){
    		document.getElementById("distanceUnit").childNodes[0].nodeValue = "kilometers";
    	}
    	else if (distanceUnit == "mile"){
    		document.getElementById("distanceUnit").childNodes[0].nodeValue = "miles";
    	}
    }

    function calculateTotalPrice(){
        if (!userCity){
            alert("You must choose a city!");
            return;
        }
    	var ridesPerWeek = document.getElementById("ridesPerWeek").value;
    	var distanceOfRides = document.getElementById("distanceOfRides").value;
    	var durationOfRides = document.getElementById("durationOfRides").value;
        if (isNaN(ridesPerWeek) || isNaN(distanceOfRides) || isNaN(durationOfRides)){
            alert("Enter in Numbers!");
            return;
        }

        var ridesPerYear = ridesPerWeek * 52.14;
        var pricePerRide = ((distanceOfRides*costPerDistance)+(durationOfRides*costPerMinute)+baseFare+safeRidesFee);
        if (pricePerRide < minimumFare) {
            pricePerRide = minimumFare;
        }
        var pricePerYear = ridesPerYear*pricePerRide;
        pricePerYear = Math.round(pricePerYear);
        //document.getElementById("uberFinal").innerHTML = '$' + pricePerYear;
    }

    function initMap(mapLat,mapLong,mapZoom) {
        var mapCanvas = document.getElementById('map');
        var mapOptions = {
        	center: new google.maps.LatLng(mapLat, mapLong),
        	zoom: mapZoom,
        	mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(mapCanvas, mapOptions);
    }
    google.maps.event.addDomListener(window, 'load', initMap(40,-100,3));

    function goToMap(){
    	initMap();
    	var cityLat = userCity.coordinates[0];
    	var cityLong = userCity.coordinates[1];
    	initMap(cityLat,cityLong,13);
    }

    var carIndex = 0;

    function upCar(num){
        carIndex += num;
        if (carIndex > (carPrices.length-1)){
            carIndex = carPrices.length-1;
        }
        if (carIndex < (0)){
            carIndex = 0;
        }
        document.getElementById("carImage").src = carPrices[carIndex].imageUrl;
        document.getElementById("carName").innerHTML = carPrices[carIndex].carName;
        document.getElementById("carPrice").innerHTML = carPrices[carIndex].price;
    }

    function skipCar(num){
        carIndex = num;
        document.getElementById("carImage").src = carPrices[carIndex].imageUrl;
        document.getElementById("carName").innerHTML = carPrices[carIndex].carName;
        document.getElementById("carPrice").innerHTML = carPrices[carIndex].price;
    }

    </script>

<form onsubmit="calculateTotalPrice(); return false;" style="float:right; margin-right:20%;line-height:2.5em; margin-top:-2%">
	Rides Per Week:
	<input type="number" name="ridesPerWeek" id="ridesPerWeek">
    <br>
	Distance of Rides (in <span id="distanceUnit">miles</span>):
	<input type="number" name="distanceOfRides" id="distanceOfRides">
    <br>
	Duration of Rides (in minutes):
	<input type="number" name="durationOfRides" id="durationOfRides">
    <br>
    Parking Cost (per Week):
    <input type="number" name="parkingCost" id="parkingCost">
    <br>
	<input type="submit" style="color:red">
</form>

<div style = "border:.05em solid black; width:20%; height:20% margin-top:0em;margin-left:25%">
        <form onsubmit="return false;">
        <input style = "width:100%"type="search" id="citySearch" placeholder="Your city" oninput="searchCity()" >
    </form>
    <ul id="cityListDisplay" style="height:3em; width:90%; list-style-type: none; padding-left: .5em; overflow:auto"></ul>
</div>
    <br>

<div style = "width:50%; height:10%; text-align:center; margin-top:0%; float:left">
    <img src = "http://thecelebritycafe.com/sites/default/files/images/uber.jpg" alt="Uber Logo"height=20%; width=20%>
    <h3 id = "uberFinal"> hello</h3>
</div>

<div style="float:right; width:50%; height:30%; text-align:center; margin-top:-20%; margin-right:6%; z-index:5; position:relative">
    <button style = "width:12em;height:3em"type="button" id = "upCar" onclick="upCar(1)">Click Me!</button>
</div>

<img id = "carImage" style = "margin-top:-10%; margin-right: 12%; z-index: -5" src = "http://file.kelleybluebookimages.com/kbb/vehicleimage/evoxseo/cp/l/10826/2016-honda-fit-front_10826_032_640x480_wa.png" alt="Car" height=25% width=35% >

<div style="float:right; width:50%; height:30%; text-align:center; margin-top:-5%; margin-right:6%">
    <button style = "width:12em;height:3em;margin-top:-45%;z-index:5; position:relative" type="button" id="downCar" onclick="upCar(-1)"> Click Me! </button><br>
    <br>
    <br>
    <h3 style="margin-top: 0%" id = "carName"> 2016 Honda Fit </h3>
    <h3 style="margin-top: 0%" id = "carPrice"> 29687 </h3>
</div>

<div style = "float:right; width: 15%; height40%; margin-top: -20%; line-height: 3em; column-width: 5em; margin-right: -55%">
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(0)"> Car </button>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(5)"> SUV </button><br>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(9)"> Luxury </button>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(12)"> Truck </button><br>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(15)"> Electric </button><br>

</div>


<br>

</body>
</html>
