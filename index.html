<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8" />
    <title>Uber GITHUB</title>
    <style type="text/CSS">
    * { padding: 0; margin: 100; padding-left: 100; }
    #map {
    	width: 30em;
    	height: 20em;
      }

    div.bottomBack{
    background: #202024 url(https://d1a3f4spazzrp4.cloudfront.net/web-fresh/pattern-grid-dark@1x.gif) repeat left top;
    background-size: 18px 18px;
    opacity: 0.9
    }
  </style>

	<script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js"></script>


</head>
<style>
    body {
  background: #fff url(https://d1a3f4spazzrp4.cloudfront.net/web-fresh/pattern-grid@1x.jpg) repeat left top;
  color: #000;
  padding-left: 25px;
  padding-bottom: -100px;

}
</style>
<body>

<div class = "bottomBack" style = "position:absolute; height:45%; width:105%; top:65%; margin-left: -5%; z-index: -10"> </div>

    <h1 style="text-align:center; font-size:3.8em; font-family: Impact; letter-spacing: .1em; word-spacing: .5em; margin-right: 2em; margin-top: -.5%">UBER VS. CAR</h1>
    <div id="map" style="height:17em;margin-left:5%;width:30%;float:left; margin-top:-2.5%"></div>
    <script>


    var userCity = null;
    var userCityIndex = null;

    var baseFare = null;
    var costPerMinute = null;
    var costPerDistance = null;
    var minimumFare = null;
    var cancellationFee = null;
    var safeRidesFee = null;
    var distanceUnit = null;
    var currencyCode = null;

    var carIndex = 3;
    var carImageUrl = "";
    var carName = "2015 Ford Taurus";
    var carPrice = "47418";
    var submitPressed = false;


    $.getJSON("allCityPrices.json", function(data){
        allCityPrices = data;
    }).error(function(jqXhr, textStatus, error) {
        console.log("allCityPrices ERROR: " + textStatus + ", " + error);
    });

    $.getJSON("carPrices.json", function(data){
        carPrices = data;
    }).error(function(jqXhr, textStatus, error) {
        console.log("carPrices ERROR: " + textStatus + ", " + error);
    });


    function searchCity(){
    	var userInput = document.getElementById("citySearch").value;
    	var cityListDisplay = document.getElementById("cityListDisplay");
    	var matchedCities = [];

    	$.each(allCityPrices, function(index,cityData){
            cityLower = cityData.cityState[0].toLowerCase();
            if (cityLower.indexOf(userInput.toLowerCase()) >= 0){
            	matchedCities.push(index);
            }
        });
        
    	$(cityListDisplay).empty();

    	for(var i=0; i<matchedCities.length; i++){
            if (matchedCities[i]){
                myCityIndex = matchedCities[i];
                myCity = allCityPrices[myCityIndex];

                var LI = document.createElement("LI");
                cityStateString = myCity.cityState[0];
                if (myCity.cityState[1]){
                    cityStateString += ", " + myCity.cityState[1];
                }
                var textnode = document.createTextNode(cityStateString);
                LI.appendChild(textnode);

                LI.setAttribute("id", myCityIndex);
                LI.addEventListener("mouseover", highlightMe, false);
                LI.addEventListener("mouseout", unhighlightMe, false);
                LI.addEventListener("click", setCityData, true);

                cityListDisplay.appendChild(LI);
    		}
    	}

    	if (matchedCities.length === 0){
    		var noCityLI = document.createElement("LI");
    		var noCityText = document.createTextNode("No City Found");
    		noCityLI.appendChild(noCityText);
    		cityListDisplay.appendChild(noCityLI);
    	}
    }

    function highlightMe(){
    	this.setAttribute("style","background-color:Cyan");
    	var myButton = document.createElement("button");
    	myButton.innerHTML = "GO!";
    	myButton.id = "myButton";
    	myButton.setAttribute("style","margin-left:2em; pointer-events:none");
    	this.appendChild(myButton);
    }

    function unhighlightMe(){
    	this.setAttribute("style","");
    	this.removeChild(myButton);
    }

    function setCityData(){

        userCityIndex = this.id;
        userCity = allCityPrices[userCityIndex];

        $(cityListDisplay).empty();
        var LI = document.createElement("LI");
        LI.style.fontWeight = "bold";
        cityStateString = userCity.cityState[0];
        if (userCity.cityState[1]){
            cityStateString += ", " + userCity.cityState[1];
        }
        var textnode = document.createTextNode(cityStateString);
        LI.appendChild(textnode);
        cityListDisplay.appendChild(LI);

        //cityStateString = userCity.cityState[0] + ", " + userCity.cityState[1];
    	goToMap();
    	baseFare = userCity.priceData.baseFare;
    	costPerMinute = userCity.priceData.costPerMinute;
    	costPerDistance = userCity.priceData.costPerDistance;
    	minimumFare = userCity.priceData.minimumFare;
    	cancellationFee = userCity.priceData.cancellationFee;
    	safeRidesFee = userCity.priceData.safeRidesFee;
    	distanceUnit = userCity.priceData.distanceUnit;
    	currencyCode = userCity.priceData.currencyCode;
        /*alert("baseFare: " + (baseFare + safeRidesFee) + " costPerMinute: " + costPerMinute + " costPerDistance: " + costPerDistance);*/
    	if (distanceUnit == "km"){
    		document.getElementById("distanceUnit").childNodes[0].nodeValue = "kilometers";
    	}
    	else if (distanceUnit == "mile"){
    		document.getElementById("distanceUnit").childNodes[0].nodeValue = "miles";
    	}
    }

    function calculateTotalPrice(){
        if (!userCity){
            alert("You must choose a city!");
            return;
        }
    	var ridesPerWeek = document.getElementById("ridesPerWeek").value;
    	var distanceOfRides = document.getElementById("distanceOfRides").value;
    	var durationOfRides = document.getElementById("durationOfRides").value;
        var parkingPerWeek = document.getElementById("parkingCost").value;
        if (!(ridesPerWeek && durationOfRides && durationOfRides && parkingPerWeek)){
            alert("Please enter numbers");
            return;
        }
        submitPressed = true;

        var ridesPerYear = ridesPerWeek * 52.14;
        var parkingPerYear = parkingPerWeek * 52.14;
        var pricePerRide = ((distanceOfRides*costPerDistance)+(durationOfRides*costPerMinute)+baseFare+safeRidesFee);
        if (pricePerRide < minimumFare) {
            pricePerRide = minimumFare;
        }
        var pricePerYear = ridesPerYear*pricePerRide;
        pricePerYear = Math.round(pricePerYear);
        var finalCarPrice = (carPrice/3) + parkingPerYear;
        finalCarPrice = Math.round(carPrice);
        
        document.getElementById("carPrice").innerHTML = '$' + finalCarPrice;
        document.getElementById("uberFinal").innerHTML = '$' + pricePerYear;
    }

    function initMap(mapLat,mapLong,mapZoom) {
        var mapCanvas = document.getElementById('map');
        var mapOptions = {
        	center: new google.maps.LatLng(mapLat, mapLong),
        	zoom: mapZoom,
        	mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(mapCanvas, mapOptions);
    }
    google.maps.event.addDomListener(window, 'load', initMap(40,-100,3));

    function goToMap(){
    	initMap();
    	var cityLat = userCity.coordinates[0];
    	var cityLong = userCity.coordinates[1];
    	initMap(cityLat,cityLong,13);
    }

    function upCar(num){
        carIndex += num;
        if (carIndex > (carPrices.length-1)){
            carIndex = carPrices.length-1;
        }
        if (carIndex < (0)){
            carIndex = 0;
        }
        carImageUrl = carPrices[carIndex].imageUrl;
        carName = carPrices[carIndex].carName;
        carPrice = carPrices[carIndex].price;
        document.getElementById("carImage").src = carImageUrl;
        document.getElementById("carName").innerHTML = carName;
        if (submitPressed){
            calculateTotalPrice();
        }
    }

    function skipCar(num){
        carIndex = num;
        carImageUrl = carPrices[carIndex].imageUrl;
        carName = carPrices[carIndex].carName;
        carPrice = carPrices[carIndex].price;
        document.getElementById("carImage").src = carImageUrl;
        document.getElementById("carName").innerHTML = carName;
        if (submitPressed){
            calculateTotalPrice();
        }
    }

    </script>

<form onsubmit="calculateTotalPrice(); return false" style="position:absolute; width:35%; right:3.5%;line-height:2.5em; top:8.5%; font-size: 1.2em">
	Rides per Week:
	<input style = "font-size:1em;"type="number" name="ridesPerWeek" id="ridesPerWeek"><br>
	Distance per Ride (in <span id="distanceUnit">miles</span>):
	<input style = "font-size:1em" type="number" name="distanceOfRides" id="distanceOfRides"><br>
	Duration of Ride (in minutes):
	<input style = "font-size:1em" type="number" name="durationOfRides" id="durationOfRides"><br>
    Parking Cost per Week:
    <input style = "font-size:1em" type="number" name="parkingCost" id="parkingCost"><br>
	<input type="submit" style="color:red; font-size:1em; width:30%; height:110%">
</form>

<form onsubmit="return false;" style = "position:absolute; height:16%; width:20%; margin-top: -2.5%; border:.05em solid; left:39%">
        <input style = "width:98%; font-size:1.2em; margin-left: 0.5%" type="text" id="citySearch" placeholder="Enter your city..." oninput="searchCity()" >
        <ul id="cityListDisplay" style="font-size:1.2em; height:76%; width:95%; list-style-type: none; padding-left: .5em; overflow:auto; margin-top: 0%"></ul>
</form>

<div style = "position:absolute; height:23%; width:20%; margin-top:9%; border:.1em dashed; left:39%; text-align:center; font-size:1.1em; font-family:Avantgarde, sans-serif">
    <p style = "margin-top:.5em">Is having a personal driver for a year less expensive than driving yourself? Using the Uber&reg; API and surveyed information of the cost-per-year of different cars, fuel prices, and maintenance costs, this website evaluates their relative price tags.</p>
</div>

<img src = "http://thecelebritycafe.com/sites/default/files/images/uber.jpg" alt="Uber Logo"height="23%" width="13.8%" style="left:20%; top:58%; position:absolute">
<img height="16%" width="30%" alt="banner" style="position:absolute; top:83%; left:12%" src ="right-banner.png">
<h3 id="uberFinal" style="position:absolute; top:81%; left:12.2%; width:30%; height:14%; font-size: 3em; text-align:center; color:grey"></h3>

<img id = "carImage" src = "http://file.kelleybluebookimages.com/kbb/vehicleimage/evoxseo/cp/l/9736/2015-ford-taurus-front_9736_032_640x480_yz.png" alt="Car" height="55%" width="40%" style="right:8%; top:42%; position:absolute" >

<h4 style="position:absolute; top:49%; right:14%; width:30%; height:14%; font-size: 1.5em; text-align:center" id = "carName"> 2015 Ford Taurus </h4>

<img height="16%" width="30%" alt="banner" style="position:absolute; right:14%; top:83%" src="http://www.cutecliparts.com/wp-content/uploads/2015/11/Cool-Ribbon-Clip-Art1-550x191.png">

<h3 style="position:absolute; top:81%; right:14%; width:30%; height:14%; font-size: 3em; text-align:center; color:grey" id ="carPrice"></h3>

<div style = "position:absolute; float:right; width:15%; height:60%; top:55%; line-height: 3em; column-width: 5em; right:-5%">
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(0)"> Car </button><br>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(5)"> SUV </button><br>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(9)"> Luxury </button><br>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative" type="button" onclick="skipCar(12)"> Truck </button><br>
    <button style = "font-size:1.2em; width:4em; height:2em; z-index:5; position:relative;" type="button" onclick="skipCar(15)"> Electric </button><br>
</div>

<input type="image" src="http://www.pngdot.com/wp-content/uploads/2015/11/Png_Up_Arrow_01.png" name="saveForm" class="btTxt submit" style="position:absolute; top:48.5%; right:25%; width:8%; height:4%" id="upCar" onclick="upCar(1)">
<input type="image" src="http://www.clker.com/cliparts/C/C/t/u/L/0/arrow-down-gray-hi.png" name="saveForm" class="btTxt submit" style="position:absolute; top:81%; right:25%; width:8%; height:4%" id="upCar" onclick="upCar(-1)">

</body>
</html>
