<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8" />
    <title>Uber GITHUB</title>
    <style>
    * { padding: 0; margin: 100; padding-left: 100; }
    #map {
    	width: 500px;
    	height: 400px;
      }
    </style>
    </style>

	<script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js"></script>

<div id="map" style="width:600px; height:400px"></div>

    <script>

/*    
   	$.getJSON(
    "https://api.uber.com/v1/products",
    {server_token: 'TOPSECRET',latitude: '42.3600825', longitude: '-71.0588801'},
    function(data) {
    	alert('page content: ' + data);
    	$.each( data, function( key, val ) {
    		val = val[0].price_details;
    		$.each(val, function(keyB,value){
    			alert (keyB);
    			alert(value);
    		});
    		alert(key);
 		 });
    	}//,
    //"json"
	);
*/
	//Monica, is it even necessary to set this surgeDict up here? Probably not
    //var mySurgeDict = null;
    var userCity = null;

    var baseFare = null;
    var costPerMinute = null;
    var costPerDistance = null;
    var minimumFare = null;
    var cancellationFee = null;
    var safeRidesFee = null;
    var distanceUnit = null;
    var currencyCode = null;

    /*
    $.getJSON("mySurgeJson.json", function(data){
    	mySurgeDict = data;
        //$.each(data, function(city,dict){
        //});
    }).error(function(jqXhr, textStatus, error) {
                alert("surge ERROR: " + textStatus + ", " + error);
    });   
*/

    $.getJSON("myCityPrices.json", function(data){
    	myCityPricesDict = data;
    }).error(function(jqXhr, textStatus, error) {
                alert("cityPrices ERROR: " + textStatus + ", " + error);
    });  

    $.getJSON("myCityGeocodes.json", function(data){
    	myCityGeocodesDict = data;
    }).error(function(jqXhr, textStatus, error) {
                alert("cityGeocodes ERROR: " + textStatus + ", " + error);
    });  

    function searchCity(){
    	var userInput = document.getElementById("citySearch").value;
    	var cityListDisplay = document.getElementById("cityListDisplay");
    	var matchedCities = [];

    	$.each(myCityPricesDict, function(city,dict){
    		cityLower = city.toLowerCase();
            if (cityLower.indexOf(userInput.toLowerCase()) >= 0){
            	matchedCities.push(city);
            }
        });

    	$(cityListDisplay).empty();

    	for(var i=0; i<5; i++){
    		myCity = matchedCities[i];

    		var LI = document.createElement("LI");
    		var textnode = document.createTextNode(myCity);
    		LI.appendChild(textnode);

    		LI.setAttribute("id",myCity);
    		LI.addEventListener("mouseover", highlightMe, false);
    		LI.addEventListener("mouseout", unhighlightMe, false);
    		LI.addEventListener("click", setCityData, true);

    		if (matchedCities[i]){
    			cityListDisplay.appendChild(LI);
    		}
    	}

    	if (matchedCities.length === 0){
    		var noCityLI = document.createElement("LI");
    		var noCityText = document.createTextNode("No City Found");
    		noCityLI.appendChild(noCityText);
    		cityListDisplay.appendChild(noCityLI);
    	}
    }

    function highlightMe(){
    	this.setAttribute("style","background-color:Cyan");
    	var myButton = document.createElement("button");
    	myButton.innerHTML = "GO!";
    	myButton.id = "myButton";
    	myButton.setAttribute("style","margin-left:2em; pointer-events:none");
    	this.appendChild(myButton);
    }

    function unhighlightMe(){
    	this.setAttribute("style","");
    	this.removeChild(myButton);
    }

    function setCityData(){
    	userCity = this.childNodes[0].nodeValue;
    	alert(userCity);
    	goToMap();
    	baseFare = myCityPricesDict[userCity].baseFare;
    	costPerMinute = myCityPricesDict[userCity].costPerMinute;
    	costPerDistance = myCityPricesDict[userCity].costPerDistance;
    	minimumFare = myCityPricesDict[userCity].minimumFare;
    	cancellationFee = myCityPricesDict[userCity].cancellationFee;
    	safeRidesFee = myCityPricesDict[userCity].safeRidesFee;
    	distanceUnit = myCityPricesDict[userCity].distanceUnit;
    	currencyCode = myCityPricesDict[userCity].currencyCode;
    	if (distanceUnit == "km"){
    		document.getElementById("distanceUnit").childNodes[0].nodeValue = "kilometers";
    	}
    	else if (distanceUnit == "mile"){
    		document.getElementById("distanceUnit").childNodes[0].nodeValue = "miles";
    	}
    }

    function calculateTotalPrice(){
    	var ridesPerWeek = document.getElementById("ridesPerWeek").value;
    	var distanceOfRides = document.getElementById("distanceOfRides").value;
    	var durationOfRides = document.getElementById("durationOfRides").value;
        var ridesPerYear = ridesPerWeek * 1;// 52.14;
        var pricePerYear = (ridesPerYear*(distanceOfRides*costPerDistance+durationOfRides*costPerMinute+baseFare+safeRidesFee));
        
        if (pricePerYear < minimumFare*ridesPerYear){
        	pricePerYear=minimumFare*ridesPerYear;
        }

        alert("safeRidesFee: " + safeRidesFee);
        alert("costPerMinute: "+ durationOfRides*costPerMinute);
        alert("costPerDistance: " + distanceOfRides*costPerDistance);
    	alert("Price Per Year: " + pricePerYear);
    }

    function initMap(mapLat,mapLong,mapZoom) {
        var mapCanvas = document.getElementById('map');
        var mapOptions = {
        	center: new google.maps.LatLng(mapLat, mapLong),
        	zoom: mapZoom,
        	mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(mapCanvas, mapOptions);
    }
    google.maps.event.addDomListener(window, 'load', initMap(40,-100,3));

    function goToMap(){
    	initMap();
    	var cityLat = myCityGeocodesDict[userCity][0];
    	var cityLong = myCityGeocodesDict[userCity][1];
    	initMap(cityLat,cityLong,7);
    }

    </script>

<br>
<button type = "button" style="font-size: 20px" onclick="initMap(40,-100,3)">PRESS ME</button>

<div style = "border:1px solid black; width: 30%; margin:2em">
	<form onsubmit="return false;">
		<input type="search" id="citySearch" placeholder="Your city" oninput="searchCity()">
	</form>
	<ul id="cityListDisplay" style="list-style-type: none; padding-left: .5em"></ul>
</div>


<br>
<br>

<form onsubmit="calculateTotalPrice(); return false;">
	Rides Per Week:
	<input type="text" name="ridesPerWeek" id="ridesPerWeek">
	Distance of Rides (in <span id="distanceUnit">Miles</span>)
	<input type="number" name="distanceOfRides" id="distanceOfRides">
	Duration of Rides (in Minutes):
	<input type="number" name="durationOfRides" id="durationOfRides">
	<input type="submit" style="color:red">
</form>


<br>

</body>
</html>
